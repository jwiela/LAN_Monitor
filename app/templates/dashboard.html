<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - LAN Monitor</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="dashboard">
    {% include 'navbar.html' %}
    
    <div class="page-header">
        <h1>üè† Dashboard - Aktywne urzƒÖdzenia</h1>
    </div>

    <!-- Komunikaty Flash -->
    <div class="container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Statystyki -->
        <div class="stats-grid stats-compact">
            <div class="stat-card stat-compact">
                <div class="stat-icon">üìä</div>
                <div class="stat-info">
                    <h3>{{ total_devices }}</h3>
                    <p>Wszystkie urzƒÖdzenia</p>
                </div>
            </div>
            
            <div class="stat-card stat-compact stat-success">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-info">
                    <h3>{{ online_devices }}</h3>
                    <p>Online</p>
                </div>
            </div>
            
            <div class="stat-card stat-compact stat-warning">
                <div class="stat-icon">üÜï</div>
                <div class="stat-info">
                    <h3>{{ new_devices }}</h3>
                    <p>Nowe urzƒÖdzenia</p>
                </div>
            </div>
            
            <div class="stat-card stat-compact stat-info">
                <div class="stat-icon">üîî</div>
                <div class="stat-info">
                    <h3>{{ recent_alerts|length }}</h3>
                    <p>Alerty</p>
                </div>
            </div>
        </div>

        <!-- Lista urzƒÖdze≈Ñ -->
        <div class="content-section">
            <div class="section-header">
                <div class="section-header-content">
                    <h2>UrzƒÖdzenia w sieci</h2>
                    <a href="{{ url_for('main.scan_network') }}" class="btn btn-scan">
                        üîç Skanuj sieƒá
                    </a>
                </div>
            </div>
            
            {% if devices %}
                <div class="devices-table-container">
                    <table class="devices-table">
                        <thead>
                            <tr>
                                <th>Status</th>
                                <th>Nazwa</th>
                                <th>Adres IP</th>
                                <th>Adres MAC</th>
                                <th>Producent</th>
                                <th>Ostatnio widziane</th>
                                <th>Akcje</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for device in devices %}
                                <tr class="{% if not device.is_online %}device-offline{% endif %}">
                                    <td class="device-status">
                                        <span class="status-indicator {% if device.is_online %}status-online{% else %}status-offline{% endif %}">
                                            {% if device.is_online %}üü¢{% else %}üî¥{% endif %}
                                        </span>
                                        {% if device.is_new %}
                                            <span class="badge badge-new-small">NEW</span>
                                        {% endif %}
                                    </td>
                                    <td class="device-name">
                                        <strong>{{ device.hostname or 'Nieznane urzƒÖdzenie' }}</strong>
                                    </td>
                                    <td class="device-ip">{{ device.ip_address or 'N/A' }}</td>
                                    <td class="device-mac">{{ device.mac_address }}</td>
                                    <td class="device-vendor">{{ device.vendor or '-' }}</td>
                                    <td class="device-time">{{ device.last_seen.strftime('%Y-%m-%d %H:%M') }}</td>
                                    <td class="device-actions">
                                        <a href="{{ url_for('main.device_detail', device_id=device.id) }}" class="btn-link-small">
                                            Szczeg√≥≈Çy ‚Üí
                                        </a>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="empty-state">
                    <div class="empty-icon">üì°</div>
                    <h3>Brak urzƒÖdze≈Ñ</h3>
                    <p>Nie wykryto jeszcze ≈ºadnych urzƒÖdze≈Ñ w sieci.</p>
                    <p>System skanowania rozpocznie pracƒô wkr√≥tce.</p>
                </div>
            {% endif %}
        </div>

        <!-- Ca≈Çkowity ruch sieciowy -->
        <div class="content-section">
            <div class="section-header">
                <h2>üìä Ca≈Çkowity ruch sieciowy</h2>
            </div>
            
            <div class="stats-grid stats-compact">
                <div class="stat-card stat-compact stat-info">
                    <div class="stat-icon">‚¨áÔ∏è</div>
                    <div class="stat-info">
                        <h3>{{ (total_stats.total_bytes_in / 1048576) | round(2) }} MB</h3>
                        <p>Pobrano</p>
                    </div>
                </div>
                
                <div class="stat-card stat-compact stat-success">
                    <div class="stat-icon">‚¨ÜÔ∏è</div>
                    <div class="stat-info">
                        <h3>{{ (total_stats.total_bytes_out / 1048576) | round(2) }} MB</h3>
                        <p>Wys≈Çano</p>
                    </div>
                </div>
                
                <div class="stat-card stat-compact stat-warning">
                    <div class="stat-icon">üì¶</div>
                    <div class="stat-info">
                        <h3>{{ total_stats.total_packets_in + total_stats.total_packets_out }}</h3>
                        <p>Pakiety</p>
                    </div>
                </div>
                
                <div class="stat-card stat-compact">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-info">
                        <h3>{{ total_stats.device_count }}</h3>
                        <p>Aktywne</p>
                    </div>
                </div>
            </div>
            
            <!-- Wykres z Grafany -->
            <div style="margin-top: 15px;">
                <iframe 
                    src="http://192.168.1.8:3000/d-solo/adptrmz/traffic-all-devices?orgId=1&from=now-24h&to=now&timezone=browser&panelId=panel-3&__feature.dashboardSceneSolo=true&refresh=30s" 
                    width="100%" 
                    height="300" 
                    frameborder="0"
                    style="border-radius: 8px; border: 1px solid #e2e8f0;">
                </iframe>
                <p style="text-align: center; margin-top: 8px; color: #666; font-size: 13px;">
                    üìä Wykres ca≈Çkowitego ruchu w czasie rzeczywistym (ostatnie 24h)
                </p>
            </div>
        </div>

        <!-- Alerty -->
        {% if recent_alerts %}
        <div class="content-section">
            <div class="section-header">
                <h2>Ostatnie alerty</h2>
            </div>
            
            <div class="alerts-list">
                {% for alert in recent_alerts %}
                    <div class="alert-item alert-{{ alert.severity }}">
                        <div class="alert-icon">
                            {% if alert.severity == 'critical' %}‚ö†Ô∏è
                            {% elif alert.severity == 'warning' %}‚ö°
                            {% else %}‚ÑπÔ∏è{% endif %}
                        </div>
                        <div class="alert-content">
                            <strong>{{ alert.alert_type }}</strong>
                            <p>{{ alert.message }}</p>
                            <small>{{ alert.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</small>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</body>
</html>
